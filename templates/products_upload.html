{% extends "base.html" %}
{% block content %}

<div class="page-head">
  <div>
    <h2 class="title">Excel orqali yuklash</h2>
    <p class="subtitle">Mahsulotlarni ommaviy qo‚Äòshish/yangi miqdor qo‚Äòshish</p>
  </div>

  <div class="head-actions">
    <a class="btn btn-secondary" href="{{ url_for('products') }}">‚Üê Omborga qaytish</a>
    <a class="btn" href="{{ url_for('stock_export') }}">Excel eksport</a>
  </div>
</div>

<div class="grid-2">
  <div class="card">
    <h3 class="card-title">Faylni tanlang</h3>
    <p class="card-sub">.xlsx yoki .xls format. Yuklashdan keyin tizim avtomatik kurs bo‚Äòyicha USD ‚Üí so‚Äòm hisoblaydi.</p>

    <form method="post" enctype="multipart/form-data" class="upload-form">
      <label class="dropzone" for="file">
        <div class="dz-ico">üì•</div>
        <div class="dz-text">
          <div class="dz-title">Excel faylni shu yerga tashlang yoki tanlang</div>
          <div class="dz-sub">Qo‚Äòllab-quvvatlanadi: .xlsx, .xls</div>
        </div>
        <input id="file" type="file" name="file" accept=".xlsx,.xls" required />
      </label>

      <div class="file-meta" id="fileMeta" style="display:none;">
        <div class="file-pill">
          <span class="file-name" id="fileName"></span>
          <span class="file-size" id="fileSize"></span>
        </div>
      </div>

      <div class="actions">
        <button class="btn" type="submit">‚¨ÜÔ∏è Yuklash</button>
        <a class="btn btn-secondary" href="{{ url_for('products') }}">Bekor qilish</a>
      </div>
    </form>
  </div>

  <div class="card hint-card">
    <h3 class="card-title">Ustunlar (column) talabi</h3>
    <p class="card-sub">Excel ichida quyidagi ustunlar bo‚Äòlishi kerak (nomlar turlicha bo‚Äòlishi mumkin):</p>

    <div class="hint-list">
      <div class="hint-item">
        <div class="hint-k">Nomi</div>
        <div class="hint-v"><span class="tag">name</span> <span class="tag">nom</span> <span class="tag">product_name</span></div>
      </div>
      <div class="hint-item">
        <div class="hint-k">Miqdor</div>
        <div class="hint-v"><span class="tag">qty</span> <span class="tag">soni</span> <span class="tag">miqdor</span></div>
      </div>
      <div class="hint-item">
        <div class="hint-k">Optovik narx (USD)</div>
        <div class="hint-v"><span class="tag">cost_price_usd</span> <span class="tag">cost_usd</span> <span class="tag">opt_narx_usd</span></div>
      </div>
      <div class="hint-item">
        <div class="hint-k">Sotuv narxi (ixtiyoriy)</div>
        <div class="hint-v"><span class="tag">suggest_price</span> <span class="tag">sell_price</span> <span class="tag">sotuv_narx</span></div>
      </div>
    </div>

    <div class="note">
      <div class="note-title">Eslatma</div>
      <div class="note-text">
        Agar bir xil <b>name</b> va bir xil <b>cost_price_usd</b> bo‚Äòlsa, tizim mahsulotni yangilaydi va miqdorni qo‚Äòshadi.
      </div>
    </div>
  </div>
</div>

<script>
  const fileInput = document.getElementById('file');
  const fileMeta = document.getElementById('fileMeta');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');

  function humanSize(bytes){
    if(!bytes && bytes !== 0) return "";
    const units = ["B","KB","MB","GB"];
    let i = 0, v = bytes;
    while(v >= 1024 && i < units.length-1){ v/=1024; i++; }
    return v.toFixed(i === 0 ? 0 : 1) + " " + units[i];
  }

  fileInput.addEventListener('change', () => {
    const f = fileInput.files && fileInput.files[0];
    if(!f){ fileMeta.style.display = "none"; return; }
    fileName.textContent = f.name;
    fileSize.textContent = humanSize(f.size);
    fileMeta.style.display = "block";
  });
</script>

<style>
  .page-head{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:14px;
    margin-bottom:16px;
  }
  .title{ margin:0 0 6px 0; font-size:24px; letter-spacing:.2px; }
  .subtitle{ margin:0; color: rgba(229,231,235,.72); font-size:14px; }
  .head-actions{ display:flex; gap:10px; flex-wrap:wrap; }

  .grid-2{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:14px;
    align-items:start;
  }

  .card{
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.03);
    border-radius: 16px;
    padding: 18px;
  }
  .card-title{
    margin:0 0 8px 0;
    font-size:16px;
    font-weight:900;
    color: rgba(229,231,235,.95);
    letter-spacing:.2px;
  }
  .card-sub{
    margin:0 0 14px 0;
    color: rgba(229,231,235,.65);
    font-size:13px;
    line-height:1.45;
  }

  .upload-form{ margin:0; }

  .dropzone{
    position:relative;
    display:flex;
    gap:12px;
    padding:16px;
    border-radius: 16px;
    border: 1px dashed rgba(255,255,255,.22);
    background: rgba(255,255,255,.04);
    cursor:pointer;
    transition: transform .08s ease, border-color .08s ease, background .08s ease;
  }
  .dropzone:hover{
    border-color: rgba(255,255,255,.35);
    background: rgba(255,255,255,.06);
    transform: translateY(-1px);
  }
  .dropzone input[type="file"]{
    position:absolute;
    inset:0;
    opacity:0;
    cursor:pointer;
  }
  .dz-ico{
    width:44px; height:44px;
    display:flex; align-items:center; justify-content:center;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.06);
    font-size:18px;
  }
  .dz-title{ font-weight:900; color: rgba(229,231,235,.95); }
  .dz-sub{ margin-top:4px; font-size:12px; color: rgba(229,231,235,.60); }

  .file-meta{ margin-top:12px; }
  .file-pill{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
  }
  .file-name{
    font-weight:900;
    color: rgba(229,231,235,.92);
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    max-width: 260px;
  }
  .file-size{
    color: rgba(229,231,235,.60);
    font-size:12px;
    white-space:nowrap;
  }

  .actions{
    display:flex;
    gap:10px;
    margin-top:14px;
    flex-wrap:wrap;
  }

  .hint-list{
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .hint-item{
    padding:12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
  }
  .hint-k{
    font-weight:900;
    margin-bottom:8px;
    color: rgba(229,231,235,.92);
    font-size:13px;
  }
  .hint-v{ display:flex; flex-wrap:wrap; gap:8px; }

  .tag{
    display:inline-flex;
    padding: 6px 10px;
    border-radius: 999px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    font-size:12px;
    font-weight:800;
    color: rgba(229,231,235,.88);
    white-space:nowrap;
  }

  .note{
    margin-top:14px;
    padding:12px;
    border-radius: 14px;
    border: 1px solid rgba(59,130,246,.28);
    background: rgba(59,130,246,.10);
  }
  .note-title{
    font-weight:900;
    margin-bottom:6px;
    color: rgba(229,231,235,.95);
  }
  .note-text{
    color: rgba(229,231,235,.75);
    font-size:13px;
    line-height:1.45;
  }

  @media (max-width: 900px){
    .grid-2{ grid-template-columns: 1fr; }
  }
</style>

{% endblock %}
